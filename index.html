<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Global Plane Crashes (1908â€“2023)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;margin:18px;background:#fafafa}
    h1{margin:0 0 8px}
    #map{margin-top:10px}
    #msg{margin-top:12px;color:#b00020;font-weight:600}
  </style>
</head>
<body>
  <h1>Global Plane Crashes (1908â€“2023)</h1>
  <div id="map"></div>
  <div id="msg"></div>

  <script>
    // ðŸ”— EDIT ME if your CSV filename/path is different
    const CSV_URL = "https://vika-senthil.github.io/W10HomeWork/WEEK%2010%20-%20Sheet1.csv";
    // e.g.: const CSV_URL = "https://vika-senthil.github.io/W10HomeWork/plane_crashes.csv";

    // Quick pre-check: can the browser reach your CSV?
    fetch(CSV_URL, {cache: "no-store"})
      .then(r => {
        if (!r.ok) throw new Error(`CSV not reachable (${r.status})`);
        return r.text();
      })
      .then(() => render())
      .catch(err => {
        document.getElementById("msg").textContent =
          "CSV load error: " + err.message + " â€” check the URL/filename/casing.";
      });

    function render(){
      const spec = {
        "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
        "width": 900,
        "height": 480,
        "title": "Global Plane Crashes (1908â€“2023)",
        "projection": {"type": "equalEarth"},

        "params": [
          {
            "name": "yearSel",
            "value": 2014,
            "bind": {"input":"range","min":1908,"max":2023,"step":1,"name":"Year: "}
          }
        ],

        "layer": [
          { "data": {"sphere": {}},      "mark": {"type":"geoshape","fill":"#eef6ff"} },
          { "data": {"graticule": true}, "mark": {"type":"geoshape","stroke":"#d0d7de","strokeWidth":0.4} },
          {
            "data": {
              "url": "https://unpkg.com/vega-datasets@2.11.0/data/world-110m.json",
              "format": {"type":"topojson","feature":"countries"}
            },
            "mark": {"type":"geoshape","fill":"#e6e6e6","stroke":"white","strokeWidth":0.5}
          },
          {
            "data": {
              "url": CSV_URL,
              "format": {
                "type": "csv",
                "parse": {"Latitude":"number","Longitude":"number","Fatalities":"number"}
              }
            },
            "transform": [
              {"filter":"isFinite(datum.Latitude) && isFinite(datum.Longitude)"},
              {
                "calculate":"isFinite(toNumber(datum.Fatalities)) && toNumber(datum.Fatalities) >= 0 ? toNumber(datum.Fatalities) : 0",
                "as":"fatalOK"
              },
              {
                "calculate":"toNumber(substring(datum.Date, length(datum.Date)-4, length(datum.Date)))",
                "as":"Year"
              },
              {"filter":"isFinite(datum.Year) && datum.Year == yearSel"}
            ],
            "mark": {"type":"circle","opacity":0.75,"stroke":"#333","strokeWidth":0.2},
            "encoding": {
              "longitude": {"field":"Longitude","type":"quantitative"},
              "latitude":  {"field":"Latitude","type":"quantitative"},
              "size":   {"field":"fatalOK","type":"quantitative","title":"Fatalities","scale":{"range":[30,800]}},
              "color":  {"field":"fatalOK","type":"quantitative","title":"Fatalities","scale":{"scheme":"reds"}},
              "tooltip":[
                {"field":"Date","title":"Date"},
                {"field":"Location","title":"Location"},
                {"field":"Operator","title":"Operator"},
                {"field":"Fatalities","title":"Fatalities (raw)"},
                {"field":"fatalOK","title":"Fatalities (parsed)"},
                {"field":"Latitude","title":"Lat"},
                {"field":"Longitude","title":"Lon"}
              ]
            }
          },
          {
            "data": { "values": [
              {"Longitude":105.0,"Latitude":5.0,"Label":"MH370 (2014)"},
              {"Longitude":-16.34,"Latitude":28.48,"Label":"Tenerife (1977)"}
            ]},
            "mark": {"type":"text","fontSize":12,"fontWeight":"bold","dx":8,"dy":-8,"color":"black"},
            "encoding": {
              "longitude":{"field":"Longitude","type":"quantitative"},
              "latitude":{"field":"Latitude","type":"quantitative"},
              "text":{"field":"Label"}
            }
          }
        ]
      };

      vegaEmbed('#map', spec, {actions:false})
        .then(()=>{ document.getElementById("msg").textContent = ""; })
        .catch(err=>{
          console.error(err);
          document.getElementById("msg").textContent =
            "Vega-Lite error: " + (err?.message || err);
        });
    }
  </script>
</body>
</html>
